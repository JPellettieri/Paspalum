x = "Línea",
y = "Densidad de inflorescencias (DMR, predicho)",
title = "Medias estimadas de DMR por línea"
) +
theme_minimal(base_size = 13)
## RELATIVIZADO A CANTIDAD DE PLANTULAS ####
REL_DMR_Linea <- lmer(DMR ~ Línea + (1|Localidad) + (1|Año), data = relativos) ##Cambiar poner poison!
summary(REL_DMR_Linea)
anova(REL_DMR_Linea)  #Si
Remm_lineas <- emmeans(REL_DMR_Linea, ~ Línea) #contraste
pairs(Remm_lineas, adjust = "tukey") #J7-L37 y J7-UF93 de pedo se mantienen las dif. la k14-L37 en este caso es MARGINAL en el caso anterior no
Remm_lineas <- emmeans(REL_DMR_Linea, ~ Línea) # Medias estimadas de DMR por Línea
#Rcld_lineas <- cld(Remm_lineas, Letters = letters, adjust = "tukey")
Rdf_plot <- as.data.frame(Remm_lineas)
ggplot(Rdf_plot, aes(x = Línea, y = emmean, fill = Línea)) + geom_col(color = "black") + geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL),
width = 0.2, size = 0.8) +
#geom_text(aes(label = .group, y = emmean + 5),   # ajustá el +5 según escala de DMR
#          size = 5) +
scale_fill_manual(values = cols_mod) +
labs(
x = "Línea",
y = "Densidad de inflorescencias relativizado a la cantidad de plantulas",
title = "Medias estimadas de DMR" ) + theme_minimal(base_size = 13)
####    VARIABLES  ####
#Hay una banda de variables muchas surgen de cuentas hechas a partir de otras, en el doc hay un glosario de variables
#A grandes razgos los aspectos q se evaluaron fueron:
#Pl/m: Plántulas por metro lineal de surco: Entiendo que se refiere a la cantidad de plantulas q se pusieron en un principio en cada sitio, en dicho caso tiene sentido que RELATIVICEMOS todos los resultados a la cantidad inicial de plantulas de cada sitio!
Plantulas <- crudos %>%
group_by(Año, Localidad, Línea) %>%
summarise(Pl_m = mean(`Pl/m`, na.rm = TRUE)) # Es una paja que la variable tenga / habria que sacarsela a todas las varibles, podemos poner _ en su lugar
print(Plantulas)
summary(Plantulas)
summary(relativo$PD.d)
summary(relativos$PD.d)
summary(relativos$PF.d)
summary(relativos$PF.d)
View(relativos)
summary(relativos$TC.d)
summary(relativos$TC.d1)
summary(relativos$TC.d 1)
summary(relativos$`TC.d 1`)
summary(relativos$`TC.d 2`)
summary(relativos$`TC.d 1`)
summary(relativos$`TC.d 2`)
summary(relativos$`TC.d 3`)
summary(relativos$`TC.d 4`)
View(datos_dia)
summary(relativos$DMT)
summary(relativos$DMR)
summary(relativos$semillas)
summary(relativos$`Prod. Sem`)
summary(relativos$`Prod. Sem`)
SD(relativos$`Prod. Sem`)
sd(relativos$`Prod. Sem`)
str(relativos)
# ---- Resumen por Temporada (Año) ----
tabla_temporada <- datos_resumen %>%
group_by(Año) %>%
summarise(
`Promedio de Plántulas por gramo de semilla` = mean(plantulas_x_gr, na.rm = TRUE),
`Promedio de macollos` = mean(macollos, na.rm = TRUE),
`% macollos reproductivos` = mean(porc_macollos_reprod, na.rm = TRUE),
`semillas por plántula` = mean(semillas_x_plantula, na.rm = TRUE),
`% semillas llenas` = mean(porc_semillas_llenas, na.rm = TRUE)
)
library(dplyr)
library(purrr)
library(ggplot2)
library(MuMIn)
library(tidyr)
library(tidyverse)
library(broom)
library(lme4)
library(scales)
library(glmmTMB)
library(DHARMa)
library(emmeans)
library(readxl)
crudos <- read_excel("CJB_Datos concurso jovenes de bioestadistica.xlsx")
summary(crudos)
# Paso a factor las variables que crrespondan
crudos$Bloque<- as.factor(crudos$Bloque)
#veo si esta balanceado entre tratamientos
table(crudos$Año)
table(crudos$Localidad)
table(crudos$Línea)
# Cruce Línea x Localidad x año
xtabs(~ Año + Localidad + Línea, data = crudos)
####    VARIABLES  ####
#Hay una banda de variables muchas surgen de cuentas hechas a partir de otras, en el doc hay un glosario de variables
#A grandes razgos los aspectos q se evaluaron fueron:
#Pl/m: Plántulas por metro lineal de surco: Entiendo que se refiere a la cantidad de plantulas q se pusieron en un principio en cada sitio, en dicho caso tiene sentido que RELATIVICEMOS todos los resultados a la cantidad inicial de plantulas de cada sitio!
Plantulas <- crudos %>%
group_by(Año, Localidad, Línea) %>%
summarise(Pl_m = mean(`Pl/m`, na.rm = TRUE)) # Es una paja que la variable tenga / habria que sacarsela a todas las varibles, podemos poner _ en su lugar
print(Plantulas)
summary(Plantulas)
#alv faltan un monton de datos, faltan todos los de 2024 - 2025, ademas no todas las lineas tienen las mismas plantulas iniciales asique vamos a tener que relativizar!
tabla_valores <- Plantulas %>%
select(Año, Localidad, Línea, Pl_m) %>%
pivot_wider(
names_from = Localidad,
values_from = Pl_m
)
# 1) Tomamos como referencia la densidad de plantas (Pl/m) de 23-24
plantas_ref <- crudos %>%
filter(Año == "23-24") %>%
group_by(Localidad, Línea, Bloque) %>%
summarise(Pl_m_ref = mean(`Pl/m`, na.rm = TRUE), .groups = "drop")
# 2) Creamos la base 'relativos'
relativos <- crudos %>%
left_join(plantas_ref, by = c("Localidad", "Línea", "Bloque")) %>%
mutate(
# usamos siempre Pl/m de 23-24 como denominador
Pl_m_usada = ifelse(Año == "24-25", Pl_m_ref, `Pl/m`)
) %>%
# 3) Dividimos todas las variables numéricas (excepto Pl/m y las auxiliares)
mutate(across(
where(is.numeric) & !c("Pl/m","Pl_m_ref","Pl_m_usada"),
~ .x / Pl_m_usada
))
###### TABLAS RESUMEN ######
# Dataset con indicadores listos
datos_resumen <- datos %>%
mutate(
plantulas_x_gr = Pl/m,            # ya es por gramo
macollos = DMT,                   # macollos por plántula
porc_macollos_reprod = `%MR`,     # porcentaje
semillas_x_plantula = `Prod. Sem`,
porc_semillas_llenas = `%llenado`
)
###### TABLAS RESUMEN ######
# Dataset con indicadores listos
datos_resumen <- relativos %>%
mutate(
plantulas_x_gr = Pl/m,            # ya es por gramo
macollos = DMT,                   # macollos por plántula
porc_macollos_reprod = `%MR`,     # porcentaje
semillas_x_plantula = `Prod. Sem`,
porc_semillas_llenas = `%llenado`
)
###### TABLAS RESUMEN ######
# Dataset con indicadores listos
datos_resumen <- relativos %>%
mutate(
plantulas_x_gr = `Pl/m`,            # ya es por gramo
macollos = DMT,                   # macollos por plántula
porc_macollos_reprod = `%MR`,     # porcentaje
semillas_x_plantula = `Prod. Sem`,
porc_semillas_llenas = `%llenado`
)
# ---- Resumen por Línea ----
tabla_linea <- datos_resumen %>%
group_by(Línea) %>%
summarise(
`Promedio de Plántulas por gramo de semilla` = mean(plantulas_x_gr, na.rm = TRUE),
`Promedio de macollos` = mean(macollos, na.rm = TRUE),
`% macollos reproductivos` = mean(porc_macollos_reprod, na.rm = TRUE),
`semillas por plántula` = mean(semillas_x_plantula, na.rm = TRUE),
`% semillas llenas` = mean(porc_semillas_llenas, na.rm = TRUE)
)
`Pl/m`
tabla_linea
View(tabla_linea)
###### TABLAS RESUMEN ######
# Preparar dataset con indicadores
datos_resumen <- datos %>%
mutate(
plantulas_x_gr = `Pl/m`,           # ya es por gramo
macollos = DMT,                    # macollos por plántula
porc_macollos_reprod = `%MR`,      # porcentaje
semillas_x_plantula = `Prod. Sem`, # ya relativizado
porc_semillas_llenas = `%llenado`
)
# ---- Resumen por Línea ----
tabla_linea <- datos_resumen %>%
group_by(Línea) %>%
summarise(
`Plántulas/g (mean ± sd)` = paste0(
round(mean(plantulas_x_gr, na.rm = TRUE), 2), " ± ",
round(sd(plantulas_x_gr, na.rm = TRUE), 2)
),
`Macollos (mean ± sd)` = paste0(
round(mean(macollos, na.rm = TRUE), 2), " ± ",
round(sd(macollos, na.rm = TRUE), 2)
),
`% macollos reproductivos (mean ± sd)` = paste0(
round(mean(porc_macollos_reprod, na.rm = TRUE), 2), " ± ",
round(sd(porc_macollos_reprod, na.rm = TRUE), 2)
),
`Semillas/plántula (mean ± sd)` = paste0(
round(mean(semillas_x_plantula, na.rm = TRUE), 2), " ± ",
round(sd(semillas_x_plantula, na.rm = TRUE), 2)
),
`% semillas llenas (mean ± sd)` = paste0(
round(mean(porc_semillas_llenas, na.rm = TRUE), 2), " ± ",
round(sd(porc_semillas_llenas, na.rm = TRUE), 2)
)
)
View(tabla_linea)
# ---- Resumen por Localidad ----
tabla_localidad <- datos_resumen %>%
group_by(Localidad) %>%
summarise(
`Plántulas/g (mean ± sd)` = paste0(
round(mean(plantulas_x_gr, na.rm = TRUE), 2), " ± ",
round(sd(plantulas_x_gr, na.rm = TRUE), 2)
),
`Macollos (mean ± sd)` = paste0(
round(mean(macollos, na.rm = TRUE), 2), " ± ",
round(sd(macollos, na.rm = TRUE), 2)
),
`% macollos reproductivos (mean ± sd)` = paste0(
round(mean(porc_macollos_reprod, na.rm = TRUE), 2), " ± ",
round(sd(porc_macollos_reprod, na.rm = TRUE), 2)
),
`Semillas/plántula (mean ± sd)` = paste0(
round(mean(semillas_x_plantula, na.rm = TRUE), 2), " ± ",
round(sd(semillas_x_plantula, na.rm = TRUE), 2)
),
`% semillas llenas (mean ± sd)` = paste0(
round(mean(porc_semillas_llenas, na.rm = TRUE), 2), " ± ",
round(sd(porc_semillas_llenas, na.rm = TRUE), 2)
)
)
View(tabla_localidad)
# Preparar dataset con indicadores
datos_resumen <- datos %>%
mutate(
plantulas_x_gr = `Pl/m`,           # ya es por gramo
macollos = DMT,                    # macollos por plántula
porc_macollos_reprod = `%MR`,      # porcentaje
semillas_x_plantula = `Prod. Sem`, # ya relativizado
porc_semillas_llenas = `%llenado`,
pf_total = `PF Total`              # producción de forraje total
)
# ---- Resumen por Línea ----
tabla_linea <- datos_resumen %>%
group_by(Línea) %>%
summarise(
`Plántulas/g (mean ± sd)` = paste0(
round(mean(plantulas_x_gr, na.rm = TRUE), 2), " ± ",
round(sd(plantulas_x_gr, na.rm = TRUE), 2)
),
`Macollos (mean ± sd)` = paste0(
round(mean(macollos, na.rm = TRUE), 2), " ± ",
round(sd(macollos, na.rm = TRUE), 2)
),
`% macollos reproductivos (mean ± sd)` = paste0(
round(mean(porc_macollos_reprod, na.rm = TRUE), 2), " ± ",
round(sd(porc_macollos_reprod, na.rm = TRUE), 2)
),
`Semillas/plántula (mean ± sd)` = paste0(
round(mean(semillas_x_plantula, na.rm = TRUE), 2), " ± ",
round(sd(semillas_x_plantula, na.rm = TRUE), 2)
),
`% semillas llenas (mean ± sd)` = paste0(
round(mean(porc_semillas_llenas, na.rm = TRUE), 2), " ± ",
round(sd(porc_semillas_llenas, na.rm = TRUE), 2)
),
`PF Total (mean ± sd)` = paste0(
round(mean(pf_total, na.rm = TRUE), 2), " ± ",
round(sd(pf_total, na.rm = TRUE), 2)
)
)
# Preparar dataset con indicadores
datos_resumen <- datos %>%
mutate(
plantulas_x_gr = `Pl/m`,           # ya es por gramo
macollos = DMT,                    # macollos por plántula
porc_macollos_reprod = `%MR`,      # porcentaje
semillas_x_plantula = `Prod. Sem`, # ya relativizado
porc_semillas_llenas = `%llenado`,
pf_total = `PF Total`              # producción de forraje total
)
# Preparar dataset con indicadores
datos_resumen <- relativos %>%
mutate(
plantulas_x_gr = `Pl/m`,           # ya es por gramo
macollos = DMT,                    # macollos por plántula
porc_macollos_reprod = `%MR`,      # porcentaje
semillas_x_plantula = `Prod. Sem`, # ya relativizado
porc_semillas_llenas = `%llenado`,
pf_total = `PF Total`              # producción de forraje total
)
# ---- Resumen por Línea ----
tabla_linea <- datos_resumen %>%
group_by(Línea) %>%
summarise(
`Plántulas/g (mean ± sd)` = paste0(
round(mean(plantulas_x_gr, na.rm = TRUE), 2), " ± ",
round(sd(plantulas_x_gr, na.rm = TRUE), 2)
),
`Macollos (mean ± sd)` = paste0(
round(mean(macollos, na.rm = TRUE), 2), " ± ",
round(sd(macollos, na.rm = TRUE), 2)
),
`% macollos reproductivos (mean ± sd)` = paste0(
round(mean(porc_macollos_reprod, na.rm = TRUE), 2), " ± ",
round(sd(porc_macollos_reprod, na.rm = TRUE), 2)
),
`Semillas/plántula (mean ± sd)` = paste0(
round(mean(semillas_x_plantula, na.rm = TRUE), 2), " ± ",
round(sd(semillas_x_plantula, na.rm = TRUE), 2)
),
`% semillas llenas (mean ± sd)` = paste0(
round(mean(porc_semillas_llenas, na.rm = TRUE), 2), " ± ",
round(sd(porc_semillas_llenas, na.rm = TRUE), 2)
),
`PF Total (mean ± sd)` = paste0(
round(mean(pf_total, na.rm = TRUE), 2), " ± ",
round(sd(pf_total, na.rm = TRUE), 2)
)
)
# ---- Resumen por Localidad ----
tabla_localidad <- datos_resumen %>%
group_by(Localidad) %>%
summarise(
`Plántulas/g (mean ± sd)` = paste0(
round(mean(plantulas_x_gr, na.rm = TRUE), 2), " ± ",
round(sd(plantulas_x_gr, na.rm = TRUE), 2)
),
`Macollos (mean ± sd)` = paste0(
round(mean(macollos, na.rm = TRUE), 2), " ± ",
round(sd(macollos, na.rm = TRUE), 2)
),
`% macollos reproductivos (mean ± sd)` = paste0(
round(mean(porc_macollos_reprod, na.rm = TRUE), 2), " ± ",
round(sd(porc_macollos_reprod, na.rm = TRUE), 2)
),
`Semillas/plántula (mean ± sd)` = paste0(
round(mean(semillas_x_plantula, na.rm = TRUE), 2), " ± ",
round(sd(semillas_x_plantula, na.rm = TRUE), 2)
),
`% semillas llenas (mean ± sd)` = paste0(
round(mean(porc_semillas_llenas, na.rm = TRUE), 2), " ± ",
round(sd(porc_semillas_llenas, na.rm = TRUE), 2)
),
`PF Total (mean ± sd)` = paste0(
round(mean(pf_total, na.rm = TRUE), 2), " ± ",
round(sd(pf_total, na.rm = TRUE), 2)
)
)
# ---- Resumen por Temporada (Año) ----
tabla_temporada <- datos_resumen %>%
group_by(Año) %>%
summarise(
`Plántulas/g (mean ± sd)` = paste0(
round(mean(plantulas_x_gr, na.rm = TRUE), 2), " ± ",
round(sd(plantulas_x_gr, na.rm = TRUE), 2)
),
`Macollos (mean ± sd)` = paste0(
round(mean(macollos, na.rm = TRUE), 2), " ± ",
round(sd(macollos, na.rm = TRUE), 2)
),
`% macollos reproductivos (mean ± sd)` = paste0(
round(mean(porc_macollos_reprod, na.rm = TRUE), 2), " ± ",
round(sd(porc_macollos_reprod, na.rm = TRUE), 2)
),
`Semillas/plántula (mean ± sd)` = paste0(
round(mean(semillas_x_plantula, na.rm = TRUE), 2), " ± ",
round(sd(semillas_x_plantula, na.rm = TRUE), 2)
),
`% semillas llenas (mean ± sd)` = paste0(
round(mean(porc_semillas_llenas, na.rm = TRUE), 2), " ± ",
round(sd(porc_semillas_llenas, na.rm = TRUE), 2)
),
`PF Total (mean ± sd)` = paste0(
round(mean(pf_total, na.rm = TRUE), 2), " ± ",
round(sd(pf_total, na.rm = TRUE), 2)
)
)
View(tabla_linea)
View(tabla_localidad)
View(tabla_temporada)
View(tabla_temporada)
# Paleta de colores
cols <- paletteer_d("ggthemes::excel_Depth")
cols_mod <- cols
cols_mod[2] <- cols[6]
str(relativos)
summary(relativos$DMT)
summary(relativos$DMR)
summary(relativos$`Prod. Sem`)
sd(relativos$`Prod. Sem`)
#  5.	DMR
"Medio que ya lo hicimos antes, habria q ver de encarar huntas las preguntas y despues ir al detalle y ya",
)
#Macollos
ggplot(crudos, aes(x = Línea, y = DMT, fill = Localidad)) +
geom_boxplot(position = position_dodge(width = 0.8)) +
labs(y = "DMT",
x = "Línea",
title = "Macollos por metro") +
theme_bw()
str(crudos)
datos_ratio <- crudos %>%
mutate(Macollos_por_pl = DMT / `Pl/m`)
ggplot(datos_ratio, aes(x = Línea, y = Macollos_por_pl, fill = Localidad)) +
geom_boxplot(position = position_dodge(width = 0.8)) +
labs(y = "Macollos por plántula (DMT / Pl_m)",
x = "Línea",
title = "Relación DMT/Plántulas por Línea y Localidad") +
theme_bw()
#Cuantos son reproductivos#
ggplot(datos_ratio, aes(x = Línea, y = `%MR`, fill = Localidad)) +
geom_boxplot(position = position_dodge(width = 0.8)) +
labs(y = "% Macollosreproductivos",
x = "Línea",
title = "% Macollos reproductivos por Línea y Localidad") +
theme_bw()
#####                    MODELOS DMR                                    #######
## Hay dif sig entre lineas? #sin relastivizar ####
DMR_Linea <- lmer(DMR ~ Línea + (1|Localidad) + (1|Año), data = crudos) #ziformula porque hay tantos 0 que rompe poisson y nbinom2 porque poisson no se banca el darma
#supuestos
res <- simulateResiduals(DMR_Linea)
plot(res)
testDispersion(res)#  Test de sobredispersión
testZeroInflation(res)#  Test de cero-inflación (exceso de ceros)
summary(DMR_Linea)
anova(DMR_Linea)  #Si
emm_lineas <- emmeans(DMR_Linea, ~ Línea) #contraste
pairs(emm_lineas, adjust = "tukey") #J7-L37 y J7-UF93
#grafiquito
emm_lineas <- emmeans(DMR_Linea, ~ Línea) # Medias estimadas de DMR por Línea
cld_lineas <- multcomp::cld(emm_lineas, Letters = letters, adjust = "tukey")
df_plot <- as.data.frame(cld_lineas)
ggplot(df_plot, aes(x = Línea, y = emmean, fill = Línea)) + geom_col(color = "black") + geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL),
width = 0.2, size = 0.8) +
geom_text(aes(label = .group, y = emmean + 5),   # ajustá el +5 según escala de DMR
size = 5) +
scale_fill_manual(values = cols_mod) +
labs(
x = "Línea",
y = "Densidad de inflorescencias (DMR, predicho)",
title = "Medias estimadas de DMR por línea"
) +
theme_minimal(base_size = 13)
#supuestos
res <- simulateResiduals(DMR_Linea)
plot(res)
testDispersion(res)#  Test de sobredispersión
testZeroInflation(res)#  Test de cero-inflación (exceso de ceros)
modelo_GEI <- glmmTMB(
DMR ~ Localidad*Línea + (1|Año),
family = tweedie(link="log"),
data = relativos
)
res <- simulateResiduals(modelo_GEI)
plot(res)
testDispersion(res)#  Test de sobredispersión
testZeroInflation(res)#  Test de cero-inflación (exceso de ceros)
# Medias estimadas de DMR por Localidad
emm_GEI <- emmeans(modelo_GEI, ~ Localidad)
summary(modelo_GEI)
anova(modelo_GEI)  #Si
emm_lineas <- emmeans(modelo_GEI, ~ Línea) #contraste
pairs(emm_lineas, adjust = "tukey") #J7-L37 y J7-UF93
emm_lineas <- emmeans(modelo_GEI, ~ Localidad)
emm_localidad <- emmeans(modelo_GEI, ~ Localidad)
pairs(emm_localidad, adjust = "tukey")
# Medias estimadas de DMR por Localidad
emm_GEI <- emmeans(modelo_GEI, ~ Localidad)
modelo_GEI <- glmmTMB(
DMR ~ Localidad*Línea + (1|Año),
family = tweedie(link="log"),
data = relativos
)
res <- simulateResiduals(modelo_GEI)
plot(res)
testDispersion(res)#  Test de sobredispersión
testZeroInflation(res)#  Test de cero-inflación (exceso de ceros)
# Medias estimadas de DMR por Localidad
emm_GEI <- emmeans(modelo_GEI, ~ Localidad)
summary(modelo_GEI)
anova(modelo_GEI)  #Si
emm_lineas <- emmeans(modelo_GEI, ~ Línea) #contraste
pairs(emm_lineas, adjust = "tukey") #J7-L37 y J7-UF93
emm_localidad <- emmeans(modelo_GEI, ~ Localidad)
pairs(emm_localidad, adjust = "tukey")
# Comparaciones post hoc con letras
cld_loc <- multcomp::cld(emm_loc, Letters = letters, adjust = "tukey")
df_plot_loc <- as.data.frame(cld_loc)
# Paleta de colores
cols <- paletteer_d("ggthemes::excel_Depth")
library(DHARMa)
library(emmeans)
library(readxl)
library(lmerTest)
library(ggplot2)
library(paletteer)
library(emmeans)
library(multcomp)
library(multcompView)
# Paleta de colores
cols <- paletteer_d("ggthemes::excel_Depth")
cols_mod <- cols
cols_mod[2] <- cols[6]
# Gráfico
ggplot(df_plot_loc, aes(x = Localidad, y = response , fill = Localidad)) +
geom_col(color = "black") +
geom_errorbar(aes(ymin = asymp.LCL, ymax = asymp.UCL),
width = 0.2, size = 0.8) +
geom_text(aes(label = .group, y = response  + 2), size = 5) +  # ajusté +2 para que las letras queden dentro del eje
scale_fill_manual(values = cols_mod) +
scale_y_continuous(limits = c(0, 1)) +  # ajusta según rango real
labs(
x = "Localidad",
y = "Densidad de inflorescencias (DMR, predicho)",
title = "Medias estimadas de DMR por localidad"
) +
theme_minimal()
